const express = require('express');
const router = express.Router();
const authMiddleware = require('../middleware/authMiddleware');

// Import from userController (login & register)
const { loginUser, registerUser } = require('../controllers/userController');

// Import from utilisateurController (CRUD operations)
const {
  getUsers,
  getUser,
  createUser,
  updateUser,
  deleteUser
} = require('../controllers/utilisateurController');

// ==================== ROUTES PUBLIQUES ====================
router.post('/login', loginUser);
router.post('/register', registerUser);

// ==================== ROUTES PROTÉGÉES ====================
// Appliquer l'authentification à toutes les routes suivantes

// Obtenir tous les users - Tous les utilisateurs authentifiés peuvent voir
router.get('/', authMiddleware(), getUsers);

// Obtenir un user spécifique - Tous les utilisateurs authentifiés peuvent voir
router.get('/:id', authMiddleware(), getUser);

// Créer un user - Admins seulement
router.post('/', authMiddleware('admin'), createUser);

// Modifier un user - Admins seulement
router.put('/:id', authMiddleware('admin'), updateUser);

// Supprimer un user - Admins seulement
router.delete('/:id', authMiddleware('admin'), deleteUser);

module.exports = router;